# Replace Variables

This plugin provides seven replace variables to access information about deferred actions during event handling. These variables are populated when deferred action events fire and can be used in chat messages, custom scripts, and other Firebot features that support replace variables.

## Table of Contents

- [deferredActionCancellationReason](#deferredactioncancellationreason)
- [deferredActionEffectId](#deferredactioneffectid)
- [deferredActionExecutionTime](#deferredactionexecutiontime)
- [deferredActionScheduledTasks](#deferredactionscheduledtasks)
- [deferredActionTaskGroup](#deferredactiontaskgroup)
- [deferredActionTaskId](#deferredactiontaskid)
- [deferredActionUserComment](#deferredactionusercomment)

## deferredActionCancellationReason

Returns the reason why a deferred action was canceled.

**Variable name:** `$deferredActionCancellationReason`

**Data type:** Text

**Available in:**

- `deferred-action:deferred-action-canceled` event
- Manual triggers (intended for testing only)

**Possible values:**

- `user` - The task was explicitly canceled by a user via the UI
- `conflict` - The task was canceled due to a task group conflict
- `effect` - The task was canceled via the "Cancel Deferred Action" effect

**Example output:** `conflict`

**Use cases:**

- Create conditional effects that respond differently based on cancellation reason
- Log why tasks were canceled for debugging
- Track cancellation patterns to identify issues with task scheduling

**Limitations:**

- Only available in the **Deferred Action Canceled** event; is unavailable in other contexts

## deferredActionEffectId

Returns the ID of the effect list that scheduled the deferred action.

**Variable name:** `$deferredActionEffectId`

**Data type:** Text

**Available in:** All deferred action events and manual triggers

**Example output:** `00000000-0000-4000-8000-000000000001`

**Use cases:**

- Identify which effect list triggered the scheduled action
- Create conditional logic based on the originating effect
- Debug and troubleshoot by tracking which effects create scheduled tasks
- Log effect IDs for audit trails

**Limitations:**

- Returns an empty string if the effect ID is not available
- Effect IDs are generated by Firebot and are not readily visible in the UI

## deferredActionExecutionTime

Returns the Unix timestamp (in milliseconds) of when the deferred action will execute.

**Variable name:** `$deferredActionExecutionTime`

**Data type:** Number

**Available in:**

- `deferred-action:deferred-action-scheduled` event
- Manual triggers (intended for testing only)

**Example output:** `1733053200000`

**Use cases:**

- Calculate remaining time until execution in custom scripts
- Display a countdown timer in chat messages
- Compare against current time to determine if a task will still execute
- Log the scheduled time for audit trails
- Sort or filter scheduled tasks by execution time

**Limitations:**

- Returns `0` if the scheduled time is not available
- Timestamp is in milliseconds (divide by 1000 for seconds)
- The actual execution time may differ slightly due to system load

## deferredActionScheduledTasks

Returns the number of deferred action tasks that are currently scheduled and waiting to run.

**Variable name:** `$deferredActionScheduledTasks`

**Data type:** Number

**Available in:** Anywhere variables are available

**Example output:** `3`

**Use cases:**

- Display how many deferred actions are currently queued
- Gate new scheduling logic if too many tasks are pending
- Log operational metrics about deferred workload

**Limitations:**

- Returns `0` if no tasks are scheduled
- Counts only in-memory tasks; pending tasks are lost if Firebot restarts

## deferredActionTaskGroup

Returns the group name assigned to the task for conflict management.

**Variable name:** `$deferredActionTaskGroup`

**Data type:** Text

**Available in:** All deferred action events and manual triggers

**Example output:** `raid-notifications`

**Use cases:**

- Identify which logical group the task belongs to
- Create conditional logic based on task grouping
- Display task grouping information in status messages
- Query or filter by group for organization and tracking

**Limitations:**

- Returns an empty string if the task was not assigned to a group
- Groups are optional; tasks without groups cannot be filtered by group
- Group names are free-form strings with no validation

## deferredActionTaskId

Returns the unique identifier of the deferred action task.

**Variable name:** `$deferredActionTaskId`

**Data type:** Text

**Available in:** All deferred action events and manual triggers

**Example output:** `00000000-0000-4000-8000-000000000000`

**Use cases:**

- Dynamically cancel specific tasks by referencing their IDs in conditional effects
- Log task IDs to a file or database for tracking
- Reference the same task across multiple effects using the task ID

**Limitations:**

- Returns an empty string if the task ID is not available in the trigger metadata
- Task IDs are generated internally and have no human-readable meaning

## deferredActionUserComment

Returns a custom comment provided when the task was scheduled.

**Variable name:** `$deferredActionUserComment`

**Data type:** Text

**Available in:** All deferred action events and manual triggers

**Example output:** `Raid follow-up: 150 raiders`

**Use cases:**

- Display task context in messages or logs
- Use as a note field for what the task does or why it was scheduled
- Reference custom metadata about the task in conditional logic

**Limitations:**

- Returns an empty string if no comment was provided when scheduling the task
- Comments are optional and may not always be populated
- Limited to text only; binary or complex data cannot be stored

## Usage Notes

### Accessing Replace Variables

Replace variables can be accessed in most Firebot features:

- Chat commands and messages
- Conditional effects
- Variable string inputs across Firebot

### When Variables Are Populated

Variables are populated based on the event that fires:

- **Task scheduled:** Available in `deferred-action:deferred-action-scheduled` event
- **Task executed:** Available in `deferred-action:deferred-action-executed` event
- **Task canceled:** Available in `deferred-action:deferred-action-canceled` event

Attempting to access a variable outside of a relevant event context will return an empty value (empty string or 0).

### Metadata Availability

All variables depend on metadata being properly attached to the event trigger. If a variable returns an empty value, it may indicate:

- The event fired outside of a deferred action context
- The variable type (e.g., task ID) was not set when the task was created
